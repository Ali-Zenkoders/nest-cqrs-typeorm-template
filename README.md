# Nest CQRS Typeorm API

**Nest CQRS Typeorm API** is the backend service for **Nest CQRS Typeorm**, template. Built with [NestJS](https://nestjs.com/) and powered by Fastify, this API provides secure, scalable, and maintainable architecture using modern best practices.

---

## 🚀 Features

### ✅ Fastify Adapter
- The app uses `@nestjs/platform-fastify` for better performance compared to Express.
- Benefits include low overhead and faster request handling.

---

### 📦 Modular Architecture
- Code is structured using feature modules:
  - `AuthModule`
  - `UserModule`
  - `SmtpModule`
  - `DatabaseModule`
- Encourages scalability and clear separation of concerns.

---

### 🔀 CQRS Pattern
- Implements the **Command Query Responsibility Segregation** (CQRS) pattern via `@nestjs/cqrs`.
- Features:
  - Commands (`RequestOtpCommand`, `ResetPasswordCommand`, etc.) for state-changing operations.
  - Queries (`GetUserQuery`) for read-only operations.
  - Events (`SendOtpEmailEvent`) for domain event propagation.

---

### 🔄 API Versioning
- Enables **URI versioning** with NestJS:
  ```
  /v1/...
- Ensures backward compatibility and smooth version upgrades.

---

### 🔐 Global Validation
- Uses `ValidationPipe` globally:
  - Validates and transforms incoming requests.
  - Rejects unknown or malformed fields.

---

### 🧱 Middleware
- Custom middleware `LoggerMiddleware` logs all incoming requests with timestamps and HTTP details.
- Applied globally to all routes.

---

### 📃 Swagger + Scalar Docs
- **Swagger UI** available at: `http://localhost:8000/docs`
- **Scalar Reference UI** at: `http://localhost:8000/reference`
- Customizations:
  - Dark theme (`swagger-themes`)
  - Custom favicon from `/public/favicon.ico`
  - Bearer token authentication

---

### 🧩 Global Interceptors
- `ResponseInterceptor` wraps all successful responses in a consistent format:
  ```json
  {
    "status": true,
    "data": { ... }
  }
  ```

---

### 📈 Rate Limiting
- Uses `@fastify/rate-limit` to prevent abuse and protect the API.
- Configuration:
  - Max: 100 requests/minute per IP
  - Headers: 
    - `x-ratelimit-limit`
    - `x-ratelimit-remaining`
    - `x-ratelimit-reset`

---

### 🛡 Helmet Security
- Integrates `@fastify/helmet` to set HTTP headers for security best practices.
- Content Security Policy is disabled for Swagger compatibility.

---

### 🌐 CORS
- CORS is enabled for all origins:
  ```ts
  origin: '*',
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
  ```

---

### 🗂 Static Assets
- Serves static files (e.g. `favicon.ico`) from `/public` folder:
  ```
  http://localhost:8000/favicon.ico
  ```

---

### 🧪 TypeORM CLI
Scripts for managing database migrations:

```bash
npm run migration:create --name=YourMigrationName
npm run migration:generate --name=AutoGeneratedName
npm run migration:run
npm run migration:revert
```

---

## 🏁 Getting Started

1. **Install dependencies**
   ```bash
   pnpm install
   ```

2. **Run the app**
   ```bash
   pnpm start:dev
   ```

3. **Access Documentation**
   - Swagger: [http://localhost:8000/docs](http://localhost:8000/docs)
   - Scalar Reference: [http://localhost:8000/reference](http://localhost:8000/reference)

---

## 🛠 Tech Stack

- **Framework**: NestJS + Fastify
- **Database**: PostgreSQL (via TypeORM)
- **Email**: SMTP (via custom SmtpModule)
- **Authentication**: OTP-based (via CQRS commands/events)
- **Documentation**: Swagger + Scalar
- **Validation**: class-validator + class-transformer
- **Security**: Helmet, Rate Limiting, CORS
- **Monorepo-ready**: Modular + Scalable architecture

---

## 📁 Folder Structure

```
src/
├── common/              # Middleware, interceptors, exceptions
├── modules/
│   ├── core/            # Core services like DB and SMTP
│   └── features/        # Business modules like Auth, User
├── main.ts              # App entry point
└── app.module.ts        # Root module
```

---

## ⚖ License

Licensed under the MIT License.